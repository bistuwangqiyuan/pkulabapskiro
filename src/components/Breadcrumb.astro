---
import type { BreadcrumbItem } from '../types';

interface Props {
    items: BreadcrumbItem[];
}

const { items } = Astro.props;

// Generate breadcrumbs from current path if items not provided
const currentPath = Astro.url.pathname;

function generateBreadcrumbs(path: string): BreadcrumbItem[] {
    const segments = path.split('/').filter(Boolean);
    const breadcrumbs: BreadcrumbItem[] = [{ label: '首页', url: '/' }];

    let currentUrl = '';
    segments.forEach((segment, index) => {
        currentUrl += `/${segment}`;
        const label = decodeURIComponent(segment)
            .split('-')
            .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
            .join(' ');

        // Last item should not have a URL (current page)
        breadcrumbs.push({
            label,
            url: index === segments.length - 1 ? undefined : currentUrl
        });
    });

    return breadcrumbs;
}

const breadcrumbItems = items && items.length > 0 ? items : generateBreadcrumbs(currentPath);
---

<nav aria-label="面包屑导航" class="bg-gray-100 py-3 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <ol class="flex items-center space-x-2 text-sm">
            {
                breadcrumbItems.map((item, index) => {
                    const isLast = index === breadcrumbItems.length - 1;
                    return (
                        <li class="flex items-center">
                            {index > 0 && (
                                <svg class="w-4 h-4 text-gray-400 mx-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            )}
                            {isLast || !item.url ? (
                                <span class="text-gray-700 font-medium" aria-current="page">
                                    {item.label}
                                </span>
                            ) : (
                                <a href={item.url} class="text-[#0066cc] hover:text-[#003d7a] no-underline transition-colors">
                                    {item.label}
                                </a>
                            )}
                        </li>
                    );
                })
            }
        </ol>
    </div>
</nav>
