---
interface Props {
    currentPage: number;
    totalPages: number;
    baseUrl: string;
}

const { currentPage, totalPages, baseUrl } = Astro.props;

// Generate page numbers to display
const getPageNumbers = () => {
    const pages: (number | string)[] = [];
    const maxVisible = 7; // Maximum number of page buttons to show

    if (totalPages <= maxVisible) {
        // Show all pages if total is small
        for (let i = 1; i <= totalPages; i++) {
            pages.push(i);
        }
    } else {
        // Always show first page
        pages.push(1);

        if (currentPage > 3) {
            pages.push('...');
        }

        // Show pages around current page
        const start = Math.max(2, currentPage - 1);
        const end = Math.min(totalPages - 1, currentPage + 1);

        for (let i = start; i <= end; i++) {
            pages.push(i);
        }

        if (currentPage < totalPages - 2) {
            pages.push('...');
        }

        // Always show last page
        pages.push(totalPages);
    }

    return pages;
};

const pageNumbers = getPageNumbers();
const hasPrev = currentPage > 1;
const hasNext = currentPage < totalPages;
---

<nav class="pagination" aria-label="分页导航">
    <ul class="pagination-list">
        {
            hasPrev && (
                <li>
                    <a href={`${baseUrl}?page=${currentPage - 1}`} class="pagination-link pagination-prev" aria-label="上一页">
                        ← 上一页
                    </a>
                </li>
            )
        }

        {
            pageNumbers.map((page) =>
                page === '...' ? (
                    <li>
                        <span class="pagination-ellipsis">...</span>
                    </li>
                ) : (
                    <li>
                        <a
                            href={`${baseUrl}?page=${page}`}
                            class:list={['pagination-link', { 'pagination-link-active': page === currentPage }]}
                            aria-label={`第 ${page} 页`}
                            aria-current={page === currentPage ? 'page' : undefined}
                        >
                            {page}
                        </a>
                    </li>
                )
            )
        }

        {
            hasNext && (
                <li>
                    <a href={`${baseUrl}?page=${currentPage + 1}`} class="pagination-link pagination-next" aria-label="下一页">
                        下一页 →
                    </a>
                </li>
            )
        }
    </ul>
</nav>

<style>
    .pagination {
        margin: 2rem 0;
    }

    .pagination-list {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        list-style: none;
        padding: 0;
        margin: 0;
        flex-wrap: wrap;
    }

    .pagination-link {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 2.5rem;
        height: 2.5rem;
        padding: 0 0.75rem;
        border: 1px solid var(--border-color, #e0e0e0);
        border-radius: 4px;
        background: var(--background, #fff);
        color: var(--text-primary, #333);
        text-decoration: none;
        font-size: 0.9rem;
        transition: all 0.2s ease;
    }

    .pagination-link:hover {
        background: var(--background-alt, #f5f5f5);
        border-color: var(--primary-color, #0066cc);
        color: var(--primary-color, #0066cc);
    }

    .pagination-link-active {
        background: var(--primary-color, #0066cc);
        color: white;
        border-color: var(--primary-color, #0066cc);
        pointer-events: none;
    }

    .pagination-prev,
    .pagination-next {
        font-weight: 500;
    }

    .pagination-ellipsis {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 2.5rem;
        height: 2.5rem;
        color: var(--text-secondary, #666);
    }

    @media (max-width: 768px) {
        .pagination-list {
            gap: 0.25rem;
        }

        .pagination-link {
            min-width: 2rem;
            height: 2rem;
            padding: 0 0.5rem;
            font-size: 0.85rem;
        }

        .pagination-ellipsis {
            min-width: 2rem;
            height: 2rem;
        }
    }
</style>
